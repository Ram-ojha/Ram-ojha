(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{AX16:function(e,t,i){"use strict";i.d(t,"a",(function(){return D})),i.d(t,"b",(function(){return C})),i.d(t,"c",(function(){return V})),i.d(t,"d",(function(){return N}));var a=i("mrSG"),s=i("lJxs"),o=i("5+tZ"),r=i("vkgz"),l=i("JX91"),n=i("LRne"),h=i("CHOV"),d=i("H0T/"),c=i("s7LF"),u=i("BHS3"),p=i("zIOW"),g=i("OJfY"),m=i("wd/R");class D{constructor(e,t,i,a,s,o,r,l,n){this._vehicleBuyPlanService=e,this._errorHandleService=t,this._route=i,this._location=a,this._router=s,this._fb=o,this.posHomeService=r,this._toastService=l,this.screenCaptureService=n,this._subscriptions=[],this.genderList=[],this.familyMemberList=[],this.stateList=[],this.cityList=[],this.pincodeList=[],this.filterCityList=[],this.insuCompanyList=[],this.yesNoList=p.k,this.NCBList=p.f,this.showLoader=!1,this.tabIndex=0,this.errMsg_oi="",this.errMsg_ca="",this.errMsg_pp="",this.errMsg_vd="",this.isreview=!1,this.isCompleted=!1,this.isCompleted_add=!1,this.isCompleted_pp=!1,this.isCompleted_vd=!1,this.isNewPolicy=!1,this.salutations=p.j,this.postData=new h.b,this.vehicleMask={guide:!1,keepCharPositions:!1,showMask:!0,mask:this.vehicleRegNoMask},this.newPolicyStartDate=new Date,this.mortgageBankList=[],this.cityPincodes=[],this.nomineeMinDate=(e,t=0,i=0)=>Object(d.j)(e,t,i),this.selectedRto="AB-09",this.date=Object(d.c)(new Date),this.newPremium=0,this.oldPremium=0,this.newPremiumModal="none",this.AppointeeDetails=!1,this.setMinDays=(e=0)=>Object(d.l)(e),this.errorLogDetails={},this.makeThirdPartyEndDateReadOnly=!1,this.ownerInfoForm=o.group({ownerName:["",[c.Validators.required,c.Validators.minLength(3),c.Validators.maxLength(60)]],ownerLastName:["",[c.Validators.required,c.Validators.minLength(3),c.Validators.maxLength(60)]],PropGenderTitle:["",c.Validators.required],gender:["",c.Validators.required],dob:["",[c.Validators.required,c.Validators.maxLength(10)]],mobileNo:["",[c.Validators.required,c.Validators.maxLength(10),c.Validators.pattern(p.g.MOBILENO)]],emailId:["",[c.Validators.required,c.Validators.pattern(p.g.EMAIL),c.Validators.maxLength(70)]],nomineeName:["",[c.Validators.required,c.Validators.minLength(3),c.Validators.maxLength(60)]],nomineeAge:["",c.Validators.required],nomineeRelation:["",c.Validators.required],AppointeeName:[""],AppointeeDOB:[""],AppointeeRelationCode:[""]}),this.addressForm=o.group({pincode:["",[c.Validators.required,c.Validators.maxLength(6),c.Validators.pattern(p.g.PINCODE)]],postalAdd:["",[c.Validators.required,c.Validators.maxLength(150)]],state:["",c.Validators.required],city:["",c.Validators.required],addArea:["",[c.Validators.required,c.Validators.maxLength(150)]]}),this.pastPolicyForm=o.group({prvPolicyStartDate:["",[c.Validators.required,c.Validators.maxLength(10)]],prvPolicyExpDate:["",[c.Validators.required,c.Validators.maxLength(10)]],thirdPartyPolicyIncepDate:[null],thirdPartyPolicyExpDate:[null],prvPolicyInsurer:["",c.Validators.required],prvPolicyNo:["",[c.Validators.required,c.Validators.maxLength(25),c.Validators.minLength(6)]],claimInPrvYear:["0",c.Validators.required],ncb:[null]}),this.vehicleDetailForm=o.group({regNo:[""],regDate:["",[c.Validators.required,c.Validators.maxLength(10)]],engineNo:["",[c.Validators.required,c.Validators.minLength(5),c.Validators.pattern(p.g.ALPHANUMERIC)]],chassisNo:["",[c.Validators.required,c.Validators.minLength(5),c.Validators.pattern(p.g.ALPHANUMERIC)]],onMortgage:["0",c.Validators.required],IsPUC:[""],bankName:[""],bankAddress:[""]})}vehicleRegNoMask(e){const t=e.split("")[1],i=isNaN(+t);return"-"!=t&&i?[/[A-Z,a-z]/,/[A-Z,a-z]/,"-",/[0-9]/,/[0-9]/,/[0-9]/,/[0-9]/]:[/[A-Z,a-z]/,"-",/[0-9]/,/[0-9]/,/[0-9]/,/[0-9]/]}ngOnInit(){this.posMobileNo=Object(d.d)(sessionStorage.getItem("posMob")),this.initialQuotationRequest=JSON.parse(sessionStorage.getItem("VehicleData")),1==this.initialQuotationRequest.edit&&(this.initialQuotationRequest.edit=0,sessionStorage.setItem("VehicleData",JSON.stringify(this.initialQuotationRequest))),this._subscriptions.push(this._route.paramMap.subscribe(e=>{const t=e.get("a_id"),i=e.get("odp");this.postData.ApplicationNo=Number(Object(d.d)(t)),this.postData.ApplicationNoOdp=Number(Object(d.d)(i))})),this.sessionData=JSON.parse(sessionStorage.getItem("Data")),console.log("Session data ==> ",this.sessionData),this.PlanData=this.sessionData.premiumDataPlans,this.reliance="11"==this.PlanData.CompanyCode,this.PlanData.rto=this.sessionData.rto,this.getRTO=this.sessionData.rto,this.PlanData.vehicleDesc=this.sessionData.vehicleDesc,this.premiumDataPlans=this.sessionData.premiumDataPlans,this.currentRegYear=+this.initialQuotationRequest.VehicleRegistrationYrDesc,this.PlanData.isOdOnly&&this.setOdValidators(),this.getData(),this.setNcbValidators(),this.getSavedData(),this.getRegYearList(),this.listenRegYearChange(),this.setMortgageValidators()}listenThirdPartyStartDate(){this.pastPolicyForm.get("thirdPartyPolicyIncepDate").valueChanges.subscribe(e=>{let t=new Date(e);t.setFullYear(t.getFullYear()+5),t.setDate(t.getDate()-1),this.pastPolicyForm.patchValue({thirdPartyPolicyExpDate:t})})}getAge(e){var t=new Date,i=new Date(e),a=t.getFullYear()-i.getFullYear(),s=t.getMonth()-i.getMonth();return console.log(i),(s<0||0===s&&t.getDate()<i.getDate())&&a--,a}appointeedetails(e,t){if(console.log("gfdfg",typeof e.target.value._i,typeof t.value),"7"==this.premiumDataPlans.CompanyCode){let t=this.getAge(e.target.value);console.log(t),t<18?(this.AppointeeDetails=!0,this.ownerInfoForm.controls.AppointeeName.setValidators([c.Validators.required]),this.ownerInfoForm.controls.AppointeeDOB.setValidators([c.Validators.required]),this.ownerInfoForm.controls.AppointeeRelationCode.setValidators([c.Validators.required])):(this.ownerInfoForm.controls.AppointeeName.setValue(""),this.ownerInfoForm.controls.AppointeeDOB.setValue(""),this.ownerInfoForm.controls.AppointeeRelationCode.setValue(""),this.ownerInfoForm.controls.AppointeeName.setValidators(null),this.ownerInfoForm.controls.AppointeeDOB.setValidators(null),this.ownerInfoForm.controls.AppointeeRelationCode.setValidators(null),this.AppointeeDetails=!1),this.ownerInfoForm.controls.AppointeeName.updateValueAndValidity(),this.ownerInfoForm.controls.AppointeeDOB.updateValueAndValidity(),this.ownerInfoForm.controls.AppointeeRelationCode.updateValueAndValidity()}}listenRegYearChange(){this._subscriptions.push("4"==this.PlanData.CompanyCode?this.vehicleDetailForm.get("regDate").valueChanges.subscribe(e=>{this.yearChanged=+new Date(e).getDate()!=+(new Date).getDate()||+new Date(e).getMonth()!=+(new Date).getMonth()||+new Date(e).getFullYear()!=+this.currentRegYear}):this.vehicleDetailForm.get("regDate").valueChanges.subscribe(e=>{this.yearChanged=+new Date(e).getFullYear()!=+this.currentRegYear}))}getRegYearList(){this._subscriptions.push(this.posHomeService.getRegYearFuelList(this.initialQuotationRequest.InsuranceCateCode).subscribe(e=>{console.log({res:e}),"0"==e.successcode&&(this.errorLogDetails.UserCode=this.posMobileNo,this.errorLogDetails.ApplicationNo=this.postData.ApplicationNo,this.errorLogDetails.CompanyName=this.PlanData.ProductName,this.errorLogDetails.ControllerName="PosHome",this.errorLogDetails.MethodName="GetFuelYearList",this.errorLogDetails.ErrorCode=e.successcode,this.errorLogDetails.ErrorDesc=e.msg,this._errorHandleService.sendErrorLog(this.errorLogDetails).subscribe(e=>{console.log(e)})),this.regYearList=this.regYearList=e.data.Table1}))}get vehValid(){return this.vehicleDetailForm.controls}setOdValidators(){const e=this.pastPolicyForm.get("thirdPartyPolicyIncepDate"),t=this.pastPolicyForm.get("thirdPartyPolicyExpDate");e.setValidators([c.Validators.required,c.Validators.maxLength(10)]),t.setValidators([c.Validators.required,c.Validators.maxLength(10)]),this.pastPolicyForm.setValidators(y),this.pastPolicyForm.updateValueAndValidity(),e.updateValueAndValidity(),t.updateValueAndValidity()}setNcbValidators(){const e=this.pastPolicyForm.get("ncb");this._subscriptions.push(this.pastPolicyForm.get("claimInPrvYear").valueChanges.subscribe(t=>{1==t?e.setValidators([c.Validators.required]):(e.setValidators(null),e.setValue("")),e.updateValueAndValidity()}))}setMortgageValidators(){const e=this.vehicleDetailForm.get("bankName"),t=this.vehicleDetailForm.get("bankAddress"),i=this.bf.get("onMortgage").value;var a,s;console.log("kljfaskljdkldfj ssfdasdfa df",i),"1"==i?(e.setValidators([c.Validators.required,c.Validators.minLength(3),c.Validators.maxLength(60),(a=this.mortgageBankList,s=this.premiumDataPlans.CompanyCode,e=>{if("13"==s||"12"==s)return null;const t=e.value;let i=a.find(e=>e.MortgageLBankName===t);return console.log(i),t&&!i?{requireMatch:!0}:null})]),t.setValidators([c.Validators.required,c.Validators.minLength(3),c.Validators.maxLength(190)])):(e.setValidators(null),t.setValidators(null),e.setValue(""),t.setValue("")),e.updateValueAndValidity(),t.updateValueAndValidity()}getData(){this.showLoader=!0,this.ownerInfoForm.patchValue({PropGenderTitle:"Mr"}),this._subscriptions.push(this._vehicleBuyPlanService.getPraposalMaster(this.premiumDataPlans.CompanyCode).subscribe(e=>{"0"==e.successcode&&(this.errorLogDetails.UserCode=this.posMobileNo,this.errorLogDetails.ApplicationNo=this.postData.ApplicationNo,this.errorLogDetails.CompanyName=this.PlanData.ProductName,this.errorLogDetails.ControllerName="VehicleData",this.errorLogDetails.MethodName="GetVehicleProposalData",this.errorLogDetails.ErrorCode=e.successcode,this.errorLogDetails.ErrorDesc=e.msg,this._errorHandleService.sendErrorLog(this.errorLogDetails).subscribe(e=>{console.log(e)})),"1"==e.successcode&&(this.genderList=e.data.Gender,this.familyMemberList=e.data.Family_Member,this.stateList=e.data.State,this.cityList=e.data.City,this.filterStateList=this.addressForm.controls.state.valueChanges.pipe(Object(l.a)(""),Object(s.a)(e=>this._filterState(e))),this.filterStateList.subscribe(e=>{console.log("input satetr ",e),this.filterState=e.filter(e=>e.StateShortDesc.toString()==this.getRTO.slice(0,2))}),this.filterStateList=this.addressForm.controls.state.valueChanges.pipe(Object(l.a)(""),Object(s.a)(e=>this._filterState(e))),this.setStateValidator(),this.setCityValidator(),this._vehicleBuyPlanService.GetPreviousInsurerByCompanyCode(this.premiumDataPlans.CompanyCode).subscribe(e=>{this.showLoader=!1,this.mortgageBankList=e.data.MortgageBankList,this.filterMortgageBankList="11"==this.premiumDataPlans.CompanyCode?Object(n.a)([]):this.vehicleDetailForm.controls.bankName.valueChanges.pipe(Object(l.a)(""),Object(s.a)(e=>this._filterBanks(e))),this.setMortgageValidators(),this.insuCompanyList=e.data.PreviousInsurerList,this.ppInsurerList=this.pastPolicyForm.controls.prvPolicyInsurer.valueChanges.pipe(Object(l.a)(""),Object(s.a)(e=>this._filterPPInsurer(e))),this.setInsuranceCompanyValidator()},t=>{this.showLoader=!1,this.errorLogDetails.UserCode=this.posMobileNo,this.errorLogDetails.ApplicationNo=this.postData.ApplicationNo,this.errorLogDetails.CompanyName=this.PlanData.ProductName,this.errorLogDetails.ControllerName="VehicleData",this.errorLogDetails.MethodName="GetVehicleProposalData",this.errorLogDetails.ErrorCode=e.successcode,this.errorLogDetails.ErrorDesc=e.msg,this._errorHandleService.sendErrorLog(this.errorLogDetails).subscribe(e=>{console.log(e)}),this._errorHandleService.handleError(t)}),this.filterCityList=[])},e=>{this.showLoader=!1,this._errorHandleService.handleError(e)}))}setStateValidator(){this.af.get("state").setValidators([c.Validators.required,C(this.stateList)]),this.af.get("state").updateValueAndValidity()}setCityValidator(){this.af.get("city").setValidators([c.Validators.required,V(this.cityList)]),this.af.get("city").updateValueAndValidity()}setPincodeValidator(){this.af.get("pincode").setValidators([c.Validators.required,N(this.pincodeList)]),this.af.get("pincode").updateValueAndValidity()}setInsuranceCompanyValidator(){var e;this.pf.get("prvPolicyInsurer").setValidators([c.Validators.required,(e=this.insuCompanyList,t=>{const i=t.value;let a=e.find(e=>e.InsuranceCompanyDesc===i);return i&&!a?{requireMatch:!0}:null})]),this.pf.get("prvPolicyInsurer").updateValueAndValidity()}getSavedData(){console.log(this.postData.ApplicationNo),console.log(this.postData.ApplicationNoOdp),this._subscriptions.push(this._vehicleBuyPlanService.getSavedPraposalData(this.postData.ApplicationNo,this.postData.ApplicationNoOdp).subscribe(e=>{if(this.showLoader=!1,"0"==e.successcode&&(this.errorLogDetails.UserCode=this.posMobileNo,this.errorLogDetails.ApplicationNo=this.postData.ApplicationNo,this.errorLogDetails.CompanyName=this.PlanData.ProductName,this.errorLogDetails.ControllerName="VehicleData",this.errorLogDetails.MethodName="GetApplicationData",this.errorLogDetails.ErrorCode=e.successcode,this.errorLogDetails.ErrorDesc=e.msg,this._errorHandleService.sendErrorLog(this.errorLogDetails).subscribe(e=>{console.log(e)})),"1"==e.successcode){let t=e.data.Table[0];this.dataToBePatched=e.data.Table1[0],this.isNewPolicy=2===t.SubCateCode,"7"!=this.PlanData.CompanyCode||this.isNewPolicy||this.vehicleDetailForm.get("IsPUC").setValidators([c.Validators.required]);const i=this.vehicleDetailForm.get("regNo");if(this.selectedRto=t.VehicleRTODesc.split(" ")[0]+"-",i.setValidators(this.isNewPolicy?[]:[c.Validators.required]),i.updateValueAndValidity(),this.BikeExpiryCode=t.VehicleExpiryCode,!this.isNewPolicy){let e,i,a=t.PreviousPolicyExpiryDate.split("/");if(a[2].split(" ").length>1){let t=a[2].split(" ")[1].split(":");a[2]=a[2].split(" ")[0],e=new Date(+a[2],+a[1]-1,+a[0],+t[0],+t[1])}else e=new Date(+a[2],+a[1]-1,+a[0]);if(a[2].split(" ").length>1){let e=a[2].split(" ")[1].split(":");a[2]=a[2].split(" ")[0],i=new Date(+a[2]-1,+a[1]-1,+a[0]+1,+e[0],+e[1])}else i=new Date(+a[2]-1,+a[1]-1,+a[0]+1);console.log(i),this.pastPolicyForm.patchValue({prvPolicyStartDate:i}),this.pastPolicyForm.patchValue({prvPolicyExpDate:e}),this.pastPolicyForm.get("prvPolicyExpDate");let s=new Date,o=t.VehicleRegistrationYrDesc;s.setFullYear(o),this.yearcount=(new Date).getFullYear()-+o,console.log(this.yearcount),this.vehicleDetailForm.patchValue({regDate:s}),this.showDates=(new Date).getFullYear()-t.VehicleRegistrationYrDesc+1,console.log(this.showDates),this.checkIfRegDateIsAllowed(),this.companyWiseRegDateValidation()}this.isNewPolicy&&this.vehicleDetailForm.patchValue({regDate:new Date}),this.ownerInfoForm.patchValue({ownerName:t.OwnerName}),this.ownerInfoForm.patchValue({ownerLastName:t.OwnerLastName}),this.vehicleDetailForm.patchValue({engineNo:t.EngineNo,chassisNo:t.VehicleIdentityNo}),this.dataToBePatched&&this.preFillProposalForm(this.dataToBePatched)}},e=>{this.showLoader=!1,this._errorHandleService.handleError(e)}))}preFillProposalForm(e){1!==e.PaymentInd?(this.ownerInfoForm.patchValue({ownerName:e.VechileOwnerName,ownerLastName:e.VehicleOwnerLastName,PropGenderTitle:e.Salutation,gender:`${e.GenderCode},${e.GenderCodeDesc}`,dob:new Date(e.DOB),mobileNo:e.MobileNo,emailId:e.EmailID,nomineeName:e.NomineeName,nomineeAge:new Date(e.NomineeDOB),nomineeRelation:`${e.RelationshipCode},${e.RelationshipDesc}`}),this.addressForm.patchValue({pincode:e.PINCode,postalAdd:e.PostalAdd,state:e.StateDesc,city:e.CityDesc,addArea:e.Area}),this.pastPolicyForm.patchValue({prvPolicyStartDate:new Date(e.PreviousPolicyStartDate),prvPolicyExpDate:new Date(e.PreviousPolicyExpDate),thirdPartyPolicyIncepDate:new Date(e.ThirdPartyPolicyInceptionDate),thirdPartyPolicyExpDate:new Date(e.ThirdPartyPolicyExpiryDate),prvPolicyInsurer:e.PreviousPolicyInsurerDesc,prvPolicyNo:e.PreviousPolicyNo,claimInPrvYear:e.ClaimInPastYearCode,ncb:e.PreviousNCB}),this.vehicleDetailForm.patchValue({regNo:e.VechileRegNo.slice(4,e.VechileRegNo.length),regDate:new Date(e.VechileRegDate),engineNo:e.VechileEngineNo,chassisNo:e.VechileChassisNo,onMortgage:e.MortgageInd.toString(),IsPUC:e.IsPUC?1:0,bankName:e.MortgageLBankName,bankAddress:e.MortgageBankAddress}),console.log("this.vehicleDetailForm",this.vehicleDetailForm)):this._router.navigateByUrl("/pos")}companyWiseRegDateValidation(){"9"===this.premiumDataPlans.CompanyCode&&(this.vehicleDetailForm.get("regDate").setValidators([P,c.Validators.required]),this.PlanData.isOdOnly&&(this.vehicleDetailForm.get("regDate").setValidators([v,P,c.Validators.required]),this.pastPolicyForm.get("prvPolicyStartDate").setValidators([v,c.Validators.required]),this.pastPolicyForm.get("thirdPartyPolicyIncepDate").setValidators([v,c.Validators.required])),this.vehicleDetailForm.get("regDate").updateValueAndValidity(),this.listenThirdPartyStartDate(),this.makeThirdPartyEndDateReadOnly=!0)}checkIfRegDateIsAllowed(){this.PlanData.isOdOnly?this.vehicleDetailForm.get("regDate").setValidators([L,c.Validators.required]):this.PlanData.isComprehensive&&this.vehicleDetailForm.get("regDate").setValidators([f,c.Validators.required]),this.vehicleDetailForm.get("regDate").updateValueAndValidity()}getMinDate(e){return Object(d.j)(e)}getMaxDate(e){return Object(d.g)(e)}getMaxRegDate(e){return Object(d.i)(e)}_filterState(e){const t=e?e.toLowerCase():e;return console.log(t.indexOf(t)),this.stateList.filter(e=>0===e.StateDesc.toLowerCase().indexOf(t))}_filterCity(e){const t=e?e.toLowerCase():e;return this.filterCityList.filter(e=>0===e.CityDesc.toLowerCase().indexOf(t))}_filterPincode(e){const t=e;return this.pincodeList.filter(e=>0===e.Pincode.toString().trim().indexOf(t))}_filterPPInsurer(e){const t=e?e.toLowerCase():e;return this.insuCompanyList.filter(e=>0===e.InsuranceCompanyDesc.toLowerCase().indexOf(t))}_filterBanks(e){const t=e.trim();return this.mortgageBankList.filter(e=>0===e.MortgageLBankName.toString().trim().indexOf(t)).slice(0,100)}onChangeTab(e){this.tabIndex=e.selectedIndex,this.setStates(e.selectedIndex)}onChangePPInsurer(){return a.__awaiter(this,void 0,void 0,(function*(){this.pastPolicyForm.get("prvPolicyInsurer")}))}onChangeStateInput(){return a.__awaiter(this,void 0,void 0,(function*(){this.stateList.find(e=>e.StateDesc===this.addressForm.value.state)&&this.onChangeState()}))}onChangeState(){return a.__awaiter(this,void 0,void 0,(function*(){const e=this.addressForm.get("state").value;this.searchState=e?this.stateList.filter(t=>t.StateDesc==e):[];let t=this.searchState[0].StateCode;this.filterCityList=t?this.cityList.filter(e=>e.StateCode==t):[],this.addressForm.controls.city.reset(),this.filteredCityList=this.addressForm.controls.city.valueChanges.pipe(Object(l.a)(""),Object(s.a)(e=>this._filterCity(e)))}))}onChangeCityInput(){this.cityList.find(e=>e.CityDesc===this.addressForm.value.city)&&this.onChangeCity()}onChangeCity(){return a.__awaiter(this,void 0,void 0,(function*(){let e=this.addressForm.get("city").value,t=this.cityList.find(t=>t.CityDesc===e);console.log(t),this.showLoader=!0,this._subscriptions.push(this._vehicleBuyPlanService.GetPincode(e,t.StateDesc).subscribe(e=>{this.showLoader=!1,"0"==e.successcode&&(this.errorLogDetails.UserCode=this.posMobileNo,this.errorLogDetails.ApplicationNo=this.postData.ApplicationNo,this.errorLogDetails.CompanyName=this.PlanData.ProductName,this.errorLogDetails.ControllerName="VehicleData",this.errorLogDetails.MethodName="GetPincodeListByDistrict",this.errorLogDetails.ErrorCode=e.successcode,this.errorLogDetails.ErrorDesc=e.msg,this._errorHandleService.sendErrorLog(this.errorLogDetails).subscribe(e=>{console.log(e)})),this.pincodeList=e.data,this.setPincodeValidator(),this.filteredautoPincodeList=this.addressForm.controls.pincode.valueChanges.pipe(Object(l.a)(""),Object(s.a)(e=>this._filterPincode(e)))}))}))}onChangeBankInput(){return a.__awaiter(this,void 0,void 0,(function*(){"13"!=this.premiumDataPlans.CompanyCode&&"12"!=this.premiumDataPlans.CompanyCode?console.log("ram "):console.log("ojha"),this.mortgageBankList.find(e=>e.MortgageLBankName===this.vehicleDetailForm.value.bankName)}))}onChangeBank(){return a.__awaiter(this,void 0,void 0,(function*(){console.log(this.mortgageBankList),this.vehicleDetailForm.get("bankName")}))}onChangePinCodeInput(){return a.__awaiter(this,void 0,void 0,(function*(){}))}onChangePincode(){return a.__awaiter(this,void 0,void 0,(function*(){this.addressForm.get("pincode")}))}onClickEdit(e){this.isNewPolicy&&3==e&&e--,this.tabIndex=e;const t=this.vehicleDetailForm.get("regNo");t.setValidators(this.isNewPolicy?[]:[c.Validators.required]),t.updateValueAndValidity(),this.isreview=!1,this.setStates(e)}onClickBack(e){let t=+Object.assign({},this.tabIndex);this.setStates(t--),setTimeout(()=>{this.tabIndex--},100)}setStates(e){switch(e){case 0:this.isCompleted=!1,this.isCompleted_add=!1,this.isCompleted_pp=!1,this.isCompleted_vd=!1;break;case 1:this.isCompleted_add=!1,this.isCompleted_pp=!1,this.isCompleted_vd=!1;break;case 2:this.isCompleted_pp=!1,this.isCompleted_vd=!1;break;case 3:this.isCompleted_vd=!1}}onClickChangeInsurer(){this._location.back()}onClickEditVehicleInfo(){let e=JSON.parse(sessionStorage.getItem("VehicleData"));e.edit=1,sessionStorage.setItem("VehicleData",JSON.stringify(e)),this._router.navigate(["/pos/bike-insurance"])}onClickPlanDetails(e){this.PlanData=JSON.parse(JSON.stringify(this.premiumDataPlans)),this.planComp.PopUp=!0,setTimeout(()=>{this.selectedIndex=e},100)}onSubmitOwnerInfo(){if(this.errMsg_oi="",this.ownerInfoForm.invalid)return this.errMsg_oi="Please fill all details correctly.",!1;this.validateOwnerInfo()&&(this.isCompleted=!0,setTimeout(()=>{this.tabIndex++},100))}onSubmitAddress(){if(console.log(this.addressForm.value),this.errMsg_ca="",this.addressForm.invalid)return this.errMsg_ca="Please fill all details correctly.",!1;this.isCompleted_add=!0,setTimeout(()=>{this.tabIndex++},100)}onSubmitPastPolicy(){if(this.errMsg_pp="",!this.isNewPolicy&&this.pastPolicyForm.invalid)return this.errMsg_pp="Please fill all details correctly.",!1;if(2!=+this.initialQuotationRequest.SubCateCode){if(this.yearChanged)return this.runQuotationRequest(),this.currentRegYear=+new Date(this.vehicleDetailForm.get("regDate").value).getFullYear(),void(this.oldPremium=Math.round(this.premiumDataPlans.AmountPayableIncludingGST));this.newPremiumModal="none"}this.showLoader=!0,this.isCompleted_pp=!0;let e=new h.b;e.ApplicationNo=this.postData.ApplicationNo,e.ApplicationNoOdp=this.postData.ApplicationNoOdp,e.DiscountAmount=this.premiumDataPlans.DiscountAmt,e.DiscountLoading=this.premiumDataPlans.DiscountLoading;const t=this.ownerInfoForm.value,i=this.addressForm.value,a=this.pastPolicyForm.value,s=this.vehicleDetailForm.value;e.VechileOwnerName=t.ownerName,e.VehicleOwnerLastName=t.ownerLastName,t.gender&&(e.GenderCode=t.gender.split(",")[0],e.GenderCodeDesc=t.gender.split(",")[1]),e.DOB=Object(d.c)(t.dob),e.MobileNo=t.mobileNo,e.EmailID=t.emailId,e.NomineeDOB=Object(d.c)(t.nomineeAge),e.NomineeName=t.nomineeName,e.Salutation=t.PropGenderTitle,t.nomineeRelation&&(e.RelationshipCode=t.nomineeRelation.split(",")[0],e.RelationshipDesc=t.nomineeRelation.split(",")[1]),e.PINCode=i.pincode,e.PostalAdd=i.postalAdd,e.Area=i.addArea;let o=this.stateList.find(e=>e.StateDesc==i.state),r=this.cityList.find(e=>e.CityDesc==i.city);if(i.state&&(e.StateCode=o.StateCode,e.StateDesc=o.StateDesc),i.city&&(e.CityCode=r.CityCode,e.CityDesc=r.CityDesc),!this.isNewPolicy){e.PreviousPolicyStartDate=Object(d.c)(a.prvPolicyStartDate),e.PreviousPolicyExpDate=Object(d.c)(a.prvPolicyExpDate),e.RegistrationDate=Object(d.c)(this.vehicleDetailForm.get("regDate").value),console.log(e.IDVAmount);let t=this.insuCompanyList.find(e=>e.InsuranceCompanyDesc==a.prvPolicyInsurer);a.prvPolicyInsurer&&(e.PreviousPolicyInsurerCode=t.InsuranceCompanyCode,e.PreviousPolicyInsurerDesc=t.InsuranceCompanyDesc),e.PreviousPolicyNo=a.prvPolicyNo}let l=this.selectedRto+s.regNo;e.VechileRegNo=l.replace(/-/g,"").length>4?l.replace(/-/g,""):`${l.replace(/-/g,"")}AA1234`,e.VechileRegDate=Object(d.c)(s.regDate),e.VechileEngineNo=s.engineNo,e.VechileChassisNo=s.chassisNo,e.IsPUC=1==s.IsPUC,e.MortgageInd=s.onMortgage;let n=this.mortgageBankList.find(e=>e.MortgageLBankName==s.bankName);"1"==e.MortgageInd?(e.MortgageIndDesc=g.b[g.b.YES],e.MortgageLBankName=n?n.MortgageLBankName:s.bankName,e.MortgageLBankCode=n?n.MortgageLBankCode:0,e.MortgageBankAddress=s.bankAddress):(e.MortgageIndDesc=g.b[g.b.NO],e.MortgageLBankName="",e.MortgageBankAddress=""),e.InsuranceCompCode=this.PlanData.CompanyCode,e.InsuranceCompDesc=this.PlanData.ProductName,e.IDVAmount=this.PlanData.IDVVAlue,e.InsurancePolicyCode=0,e.InsurancePolicyDesc="",e.ZeroDepreciationCode=this.PlanData.zeroDp?1:0,e.ZeroDepreciationDesc=this.PlanData.zeroDp,e.PolicyTenure=this.PlanData.tenure,e.PersonalAccidentCoverInd=this.PlanData.pacover?1:0,e.PersonalAccidentCoverDesc=this.PlanData.pacover,this.PlanData.isComprehensive&&(e.ComprehensiveThirdPartyCode=0,e.ComprehensiveThirdPartyDesc="COMPREHENSIVE"),this.PlanData.isTp&&(e.ComprehensiveThirdPartyCode=1,e.ComprehensiveThirdPartyDesc="TP"),this.PlanData.isOdOnly&&(e.ThirdPartyPolicyInceptionDate=Object(d.c)(a.thirdPartyPolicyIncepDate),e.ThirdPartyPolicyExpiryDate=Object(d.c)(a.thirdPartyPolicyExpDate),e.ComprehensiveThirdPartyCode=2,e.ComprehensiveThirdPartyDesc="ODONLY"),e.PolicyPremiumAmount=this.PlanData.Premium,e.CGSTPolicyPremiumAmount=0,e.SGSTPolicyPremiumAmount=0,e.IGSTPolicyPremiumAmount=0,e.TotalGSTPremiumAmount=0,e.PolicyPremiumGSTRate=0,e.GSTApplicableCode=0,e.GSTApplicableDesc="",e.OwnerGSTNo=0,e.PoicyTotalAmount=0,e.CoverageList=[];let c=this.sessionData.premiumDataPlans.CoverageList.find(e=>"IDV Basic"==e.CoverageCode);if(e.CoverageList.push(c),this.premiumDataPlans.pacover){let t=this.sessionData.premiumDataPlans.CoverageList.find(e=>16==e.CoverageID);e.CoverageList.push(t)}if(this.premiumDataPlans.zeroDp){let t=this.sessionData.premiumDataPlans.CoverageList.find(e=>1==e.CoverageID);t&&e.CoverageList.push(t)}let u=this.sessionData.premiumDataPlans.CoverageList.find(e=>"No Claim Bonus"==e.CoverageCode);if(null!=u&&e.CoverageList.push(u),this.premiumDataPlans.istppd){let t=this.sessionData.premiumDataPlans.CoverageList.find(e=>"Third Party Property Damage"==e.CoverageCode);e.CoverageList.push(t)}this.reviewData?(e.RegistrationNo=this.reviewData.Data.RegistrationNo,e.RegistrationNoOdp=this.reviewData.Data.RegistrationNoOdp):this.dataToBePatched&&(e.RegistrationNo=this.dataToBePatched.RegistrationNo,e.RegistrationNoOdp=this.dataToBePatched.RegistrationNoOdp),console.log(e),this.postData=e,console.log("this.postData",JSON.stringify(this.postData)),this._subscriptions.push(this._vehicleBuyPlanService.savePraposal(this.postData).subscribe(t=>{"1"==t.successcode?(console.log("Result ==> ",t),this.isreview=!0,this.reviewData=e,this.reviewData.Data=t.data[0],sessionStorage.setItem("postData",JSON.stringify(this.reviewData)),Object(d.f)(t.data[0].ApplicationNo.toString()),Object(d.f)(t.data[0].ApplicationNoOdp.toString()),console.log(t.data[0].ApplicationNo),sessionStorage.setItem("postData",JSON.stringify(this.reviewData)),this.showLoader=!1):(this.errorLogDetails.UserCode=this.posMobileNo,this.errorLogDetails.ApplicationNo=this.postData.ApplicationNo,this.errorLogDetails.CompanyName=this.PlanData.ProductName,this.errorLogDetails.ControllerName="VehicleData",this.errorLogDetails.MethodName="SaveVehicleRegData",this.errorLogDetails.ErrorCode=t.successcode,this.errorLogDetails.ErrorDesc=t.msg,this._errorHandleService.sendErrorLog(this.errorLogDetails).subscribe(e=>{console.log(e)}),this._errorHandleService._toastService.warning(t.msg,t.successcode),this.showLoader=!1)},e=>{this.showLoader=!1,this.errorLogDetails.UserCode=this.posMobileNo,this.errorLogDetails.ApplicationNo=this.postData.ApplicationNo,this.errorLogDetails.CompanyName=this.PlanData.ProductName,this.errorLogDetails.ControllerName="VehicleData",this.errorLogDetails.MethodName="SaveVehicleRegData",this.errorLogDetails.ErrorCode=e.successcode,this.errorLogDetails.ErrorDesc=e.msg,this._errorHandleService.sendErrorLog(this.errorLogDetails).subscribe(e=>{console.log(e)}),this._errorHandleService.handleError(e)}))}onSubmitNewPolicyPayment(){this.yearChanged=!1,this.onSubmitPastPolicy()}runQuotationRequest(){this.showLoader=!0;let e=+Object(d.c)(this.vehicleDetailForm.get("regDate").value).split("/")[2],t=(this.regYearList.find(t=>+t.RegistrationYearDesc===e),{ApplicationNo:this.postData.ApplicationNo,ApplicationNoOdp:this.postData.ApplicationNoOdp,RegistrationDate:Object(d.b)(this.vehicleDetailForm.get("regDate").value)});console.log("registration date ",t),this._subscriptions.push(this.posHomeService.saveQuatesAfterDateChange(t).pipe(Object(o.a)(e=>(console.log({res:e}),this.postData.ApplicationNo=this.postData.ApplicationNo,this.postData.ApplicationNoOdp=this.postData.ApplicationNoOdp,this._vehicleBuyPlanService.getBikeQuotationUrls(this.postData.ApplicationNo,this.postData.ApplicationNoOdp).pipe(Object(r.a)(e=>console.log({data:e})),Object(o.a)(e=>{const t=e.data.find(e=>+e.CompanyCode==+this.premiumDataPlans.CompanyCode);return this._vehicleBuyPlanService.getInsuranceCompanyPlan({PartnerId:t.Partnerid,ProductCode:t.ProductCode,ApplicationNo:t.ApplicationNo,ApplicationNoOdp:t.ApplicationNoOdp,APIBaseUrl:t.APIBaseUrl,APIMethod:t.APIMethod,PolicyTenure:this.premiumDataPlans.tenure,IDVValue:this.PlanData.IDVVAlue,PreviousNCB:this.initialQuotationRequest.PreviousNCB,CurrentNCB:this.initialQuotationRequest.CurrentNCB})}))))).subscribe(e=>{if(this.showLoader=!1,!e||"0"===e.successcode)return this.errorLogDetails.UserCode=this.posMobileNo,this.errorLogDetails.ApplicationNo=this.postData.ApplicationNo,this.errorLogDetails.CompanyName=this.PlanData.ProductName,this.errorLogDetails.ControllerName="VehicleData",this.errorLogDetails.MethodName="GetBikeQuotationUrl",this.errorLogDetails.ErrorCode=e.successcode,this.errorLogDetails.ErrorDesc=e.msg,this._errorHandleService.sendErrorLog(this.errorLogDetails).subscribe(e=>{console.log(e)}),void this._toastService.error(e.msg,"",{timeOut:5e3});this.makePremium(e),console.log(e),this.newPremiumModal="block"},e=>{this.showLoader=!1,this._errorHandleService.handleError(e)}))}closeModalDialog(){this.newPremiumModal="none"}makePremium(e){this.showLoader=!1,e.data.Premium=Math.round(e.data.NetPremium);let t=e.data.CoverageList.find(e=>"IDV Basic"===e.CoverageCode),i=e.data.CoverageList.find(e=>"No Claim Bonus"===e.CoverageCode),a=t?+t.ODPremium:0,s=t?+t.TPPremium:0,o=i?+i.ODPremium:0,r=e.data&&e.data.DiscountAmt?+e.data.DiscountAmt.replace(/-/g,""):0;this.premiumDataPlans.isComprehensive&&(e.data.Premium=a+s-r+o),this.premiumDataPlans.isTp&&(e.data.Premium=s),this.premiumDataPlans.isOdOnly&&(e.data.Premium=a-r+o),this.yearChanged=!1,this.saveNewSessionData(e.data)}addAddonsValue(e){if(this.premiumDataPlans.zeroDp){let t=e.CoverageList.find(e=>1==+e.CoverageID);t&&(e.Premium+=+t.ODPremium+ +t.TPPremium)}if(this.premiumDataPlans.pacover){let t=e.CoverageList.find(e=>16==+e.CoverageID);t&&(e.Premium+=+t.ODPremium+ +t.TPPremium)}return Math.round(e.Premium)}saveNewSessionData(e){const t=this.addAddonsValue(e),i=.18*t;this.newPremium=Math.round(t+i);let a=e.CoverageList.find(e=>"IDV Basic"===e.CoverageCode),s=e.CoverageList.find(e=>"No Claim Bonus"===e.CoverageCode),o=e.CoverageList.find(e=>"TPPD"===e.CoverageCode),r=e.CoverageList.find(e=>16==e.CoverageID),l=e.CoverageList.find(e=>1==e.CoverageID),n=Object.assign({},this.premiumDataPlans);n.CoverageList=e.CoverageList,n.PremiumWithGst=+t,n.selectedAddons=e.CoverageList,n.IDVVAlue=e.IDVVAlue,n.MaxIDVVAlue=e.MaxIDVVAlue,n.MinIDVVAlue=e.MinIDVVAlue,n.GST=i,n.AmountPayableIncludingGST=this.newPremium,n.Premium=+t,n.IdvBasic=a,n.NCB=s,n.PAOwner=r,n.TPPD=o,n.DepWaiver=l,n.policyNumber=e.policyNumber,n.DiscountAmt=e.DiscountAmt.replace(/--/g,"-"),this.premiumDataPlans.isTp&&(n.CoverageList=e.CoverageList.filter(e=>20!=e.CoverageID)),this.premiumDataPlans=JSON.parse(JSON.stringify(n)),sessionStorage.setItem("Data",JSON.stringify({rto:this.sessionData.rto,vehicleDesc:this.sessionData.vehicleDesc,premiumDataPlans:this.premiumDataPlans}))}onSubmitVehicleInfo(){if(this.errMsg_vd="",this.vehicleDetailForm.invalid)return this.errMsg_vd="Please fill all details correctly.",!1;this.isNewPolicy?(this.isCompleted_pp=!0,this.onSubmitPastPolicy()):(this.isCompleted_vd=!0,setTimeout(()=>{this.tabIndex++},100))}validateOwnerInfo(){const e=this.ownerInfoForm.get("dob").value,t=m();if(Math.abs(t.diff(e,"years"))<18)return this.errMsg_oi="Owner age should be greater than 18 years.",!1;{const i=this.ownerInfoForm.get("nomineeAge").value,a=Math.abs(t.diff(i,"years")),s=this.ownerInfoForm.get("nomineeRelation").value?this.ownerInfoForm.get("nomineeRelation").value.split(",")[0]:0,o=Math.abs(t.diff(e,"years"));if((s==u.a.Son||s==u.a.Daughter)&&a-o<18)return this.errMsg_oi="Parent age should be more than 18 years from Owner.",!1;if((s==u.a.Father||s==u.a.Mother)&&o-a<18)return this.errMsg_oi="Owner age should be more than 18 years from children.",!1}return!0}validateVehicle(){return!!(this.vehicleDetailForm.get("onMortgage").value!=g.b.YES||this.vehicleDetailForm.get("bankName").value&&this.vehicleDetailForm.get("bankAddress").value)||(this.errMsg_vd="Please fill mortgage bank details.",!1)}takeScreenShot(){this.captureScreen()}captureScreen(){return a.__awaiter(this,void 0,void 0,(function*(){try{const e=this.screenCaptureService.getImage(this.screen.nativeElement,!0);let t=yield e,i=Object.assign({},this.postData);i.screenshot=t,this.postData=i}catch(e){console.log({err:e})}}))}get af(){return this.addressForm}get pf(){return this.pastPolicyForm}get bf(){return this.vehicleDetailForm}ngOnDestroy(){this._subscriptions.forEach(e=>e.unsubscribe())}}const P=e=>{let t=new Date(e.value);return(new Date).getMonth()-t.getMonth()+12*((new Date).getFullYear()-t.getFullYear())>=117?{dateError:!0}:null},v=e=>{console.log(e.value);let t=new Date(e.value),i=new Date("2018-09-01");return i.setHours(0,0,0,0),t<i?{dateErrorSept2018:!0}:null},y=e=>{let t=e.get("thirdPartyPolicyIncepDate").value,i=e.get("thirdPartyPolicyExpDate").value,a=e.get("prvPolicyExpDate").value;const s=new Date(new Date(i).getFullYear(),new Date(i).getMonth(),new Date(i).getDate()),o=new Date(new Date(t).getFullYear(),new Date(t).getMonth(),new Date(t).getDate());if(a>=i)return{expiryDateError:!0};const r=Math.abs(+s-+o);return Math.ceil(r/864e5)<365?{thirdPartyEndDateGapError:!0}:null};function C(e){return t=>{const i=t.value;let a=e.find(e=>e.StateDesc===i);return i&&!a?{requireMatch:!0}:null}}function V(e){return t=>{const i=t.value;let a=e.find(e=>e.CityDesc===i);return i&&!a?{requireMatch:!0}:null}}function N(e){return t=>{const i=t.value;if(null===t.value||null===e)return{requireMatch:!1};let a=e.find(e=>e.Pincode===i);return i&&!a?{requireMatch:!0}:null}}const L=e=>{let t=new Date(e.value),i=new Date("2018-09-01");return i.setHours(0,0,0,0),t>=i?(new Date).getMonth()-t.getMonth()+12*((new Date).getFullYear()-t.getFullYear())>60?{OdError:!0}:void 0:{dateErrorSept2018:!0}},f=e=>{let t=new Date(e.value),i=new Date("2018-09-01");return i.setHours(0,0,0,0),t>=i&&(new Date).getMonth()-t.getMonth()+12*((new Date).getFullYear()-t.getFullYear())<=60?{CompError:!0}:null}},NysP:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));class a{constructor(e){this._location=e,this.showLoader=!1}ngOnInit(){this.errorMessage="Error"}goBack(){this._location.back()}}},"v+Py":function(e,t,i){"use strict";var a=i("8Y7J"),s=i("lzlj"),o=i("igqZ"),r=i("omvX"),l=i("NysP"),n=i("SVse");i.d(t,"a",(function(){return u}));var h=a["\u0275crt"]({encapsulation:0,styles:[[""]],data:{}});function d(e){return a["\u0275vid"](0,[(e()(),a["\u0275eld"](0,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),a["\u0275eld"](1,0,null,null,0,"br",[],null,null,null,null,null)),(e()(),a["\u0275eld"](2,0,null,null,6,"div",[["class","col-md-6 offset-md-3"]],null,null,null,null,null)),(e()(),a["\u0275eld"](3,0,null,null,5,"div",[["class","row"]],null,null,null,null,null)),(e()(),a["\u0275eld"](4,0,null,null,4,"mat-card",[["class","mat-card"]],[[2,"_mat-animation-noopable",null]],null,null,s.d,s.a)),a["\u0275did"](5,49152,null,0,o.a,[[2,r.a]],null,null),(e()(),a["\u0275eld"](6,0,null,0,2,"mat-card-title",[["class","text-center mat-card-title"]],null,null,null,null,null)),a["\u0275did"](7,16384,null,0,o.f,[],null,null),(e()(),a["\u0275ted"](8,null,[" Policy Payment "," "]))],null,(function(e,t){var i=t.component;e(t,4,0,"NoopAnimations"===a["\u0275nov"](t,5)._animationMode),e(t,8,0,i.errorMessage)}))}function c(e){return a["\u0275vid"](0,[(e()(),a["\u0275eld"](0,0,null,null,1,"payment-error",[],null,null,null,d,h)),a["\u0275did"](1,114688,null,0,l.a,[n.j],null,null)],(function(e,t){e(t,1,0)}),null)}var u=a["\u0275ccf"]("payment-error",l.a,c,{},{},[])}}]);